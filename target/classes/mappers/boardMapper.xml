<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardMapper">
	<insert id="write">
		INSERT INTO 
		BOARD_DATA(DATAUID, DATATITLE, DATACONTENT, USERNICKNAME, REGDATE) 
		VALUES(#{dataUid}, #{dataTitle}, #{dataContent}, #{userNickname}, NOW());
	</insert>
	
	<select id="datalist" resultType="com.sample.DataVO.DataVO">
		SELECT 
		DATAUID,DATATITLE,DATACONTENT,USERNICKNAME,REGDATE FROM BOARD_DATA 
		<include refid="search"></include> 
		ORDER BY REGDATE DESC LIMIT #{rowStart},#{rowEnd};
	</select>
	
	<select id="detail" parameterType="String" resultType="com.sample.DataVO.DataVO">
		SELECT 
		DATAUID, DATATITLE, DATACONTENT, USERNICKNAME, REGDATE 
		FROM BOARD_DATA 
		WHERE DATAUID = #{dataUid};
	</select>
	
	<update id="update" parameterType="com.sample.DataVO.DataVO">
		UPDATE 
		BOARD_DATA SET 
		DATATITLE = #{dataTitle}, DATACONTENT = #{dataContent} 
		WHERE DATAUID = #{dataUid};
	</update>
	
	<delete id="delete" parameterType="String">
		DELETE 
		FROM BOARD_DATA 
		WHERE DATAUID = #{dataUid};
	</delete>
	
	<select id="listCount" resultType="int">
		SELECT COUNT(*) FROM BOARD_DATA <include refid="search"></include>;
	</select>
	
	<sql id="search">
		<if test='searchType != null and searchType!=""'>
			<if test="searchType == 'dataTitle'.toString()">WHERE DATATITLE LIKE CONCAT('%',#{keyword},'%')</if>
			<if test="searchType == 'dataContent'.toString()">WHERE DATACONTENT LIKE CONCAT('%',#{keyword},'%')</if>
			<if test="searchType == 'userNickname'.toString()">WHERE USERNICKNAME LIKE CONCAT('%',#{keyword},'%')</if>
		</if>
	</sql>
</mapper>